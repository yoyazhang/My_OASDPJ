# My_OASDPJ设计文档
## 个人信息
+ 姓名：张诗涵
+ 学号：19302010074
+ 项目github网址：https://github.com/yoyazhang/My_OASDPJ

## 网站定位
### 网站服务类型
主要提供展示型服务，本网站以为提供用户展示分享旅行中拍摄的照片的平台为主要服务类型，此外提供了一定的用户间交互，包括请求好友、好友之间互相看彼此的
收藏页面、评论功能等等，但相对而言个人功能占主要部分，用户间交互占小部分。

### 受众群体分析
1. Daddy旅行社公众号、工作人员：由于网站是daddy旅行社赞助的，因此daddy旅行社会利用网站进行推广
   + 在首页的轮播图第一张放上某地优美的风景照进行推广当地的旅游行程、在官方号发布的照片中介绍当地开展的旅游项目、参与的联系方式、价格、明星推荐等等。
   + 在搜索部分可能也会将官方的照片放在前面的版位。
   + 官方号可能也会通过实时聊天功能联系专业摄影师、旅行家进行商业合作。
2. 专业摄影师：
   + 上传照片：水平较高的摄影师可能对照片的评判标准较其他人更高，因此ta自己上传的会比收藏他人的功能使用的更多。
   + 修改照片：可能会有旅行回来先上传原片，过一段时间修完图之后再替换的需求。
   + 站内实时聊天：可能会有旅行社官方账号想要邀请ta进行合作（比如请摄影师拍摄某地的风景上传来推广自己在这个风景地的旅游业务）。
3. 专业旅行家：
   + 上传功能：与专业摄影师相比，ta更多用到的可能是description部分，对图片背后的风景、怎么去、哪里值得去进行描述、分享。
   + 站内实时聊天功能：与摄影师大致相同。
4. 较为业余的旅行爱好者、摄影师：
   + 除了正常地上传自己的照片和分享外，ta还会更多地搜索专业摄影师等拍摄分享的照片进行欣赏、学习、收藏等；
   + 好友功能：想要关注那些专业用户进行请教、结识。
   + 他们也会更关注首页的消息。
5. 想要分享旅行照片、结交的普通用户：与上一种业余爱好者不同的是，他们并没有提高摄影技巧的需求（可能只是手机拍照兴致来了就发个图营业一下）
   + 修改功能通常用不到
   + 收藏他人好看的照片、评论留言、去搜索好看的照片、被图片吸引去旅游的成分更大。
6. 总结：前三种用户人数不多，但通常是这个网站大部分内容特别是优质内容的发布者、站内流行风气的引领者，而后两种人群占大部分，但发布的内容可能不多，
往往主要使用收藏、搜索等功能。

### 基本风格
网站定位为由旅行社赞助推出的旅游照片分享平台，因此风格特色为**活泼、明快、热烈**。

## 形象设计

### 配色
主色为紫红色（#d4237a）和深蓝色（#13227a），大部分链接配色为主色调互换，少部分非突出链接（或认为文字内容以蓝红示人不易分辨）为黑色（#171616），
hover后为darkgoldenrod。突出配色是紫红色（#d4237a），尤其在按钮上往往代表较为重要的选择，例如发送请求、修改图片影响较小则为深蓝，删除图片
需要用户仔细考虑并且带有警示意味则为紫红色。
### 版式
本网站主要选用的版式为：主要内容分布在画面水平中央位置的布局。大部分页面只有一栏，少部分页面会分割为两栏式布局，核心内容占60%左右居于左侧，辅助性
功能占剩余部分居于右侧，例如我的收藏页面中收藏图片和我的足迹两部分的关系。
### logo
![logo](https://github.com/yoyazhang/My_OASDPJ/tree/master/web/resources/images/icons/logo.png)
logo的配色与网站主色调一致：飞机代表travel旅行，深蓝色调，照片墙为浅紫红色调，代表share——分享你的照片，右上角的Daddy Travel表示服务提供者信息。logo
信息与网站名称一一对应（Travel To Share）

## 网站内容规划

### 项目使用的语言&工程结构
+ 前端框架主要使用了bootstrap组件和jquery库
+ 后端使用jsp+javabean+Servlet的MVC模式来实现
+ 工程文件结构：
   + src文件夹下：
      + com.travel.dao:dao类和相应要求实现的接口（如UserDAO指示关于Traveluser相关的增删改查功能）
	  + com.travel.db:继承DAO，implements 相应接口并完整实现相应功能。还有验证码生成类也放在此处。
	  + entity：javabean们，有idea直接生成（根据数据库中的字段）
	  + Filter：下文中提到的实现三个过滤功能的filter
	  + Servlet：最主要的与数据库服务器进行交互的servlets
   + web文件夹下：resources中储存css、图片、js文件等，jspFiles中储存jsp文件，二级目录admin下储存只有登录后才能看到的页面。WEB-INF下储存lib和errorPage，
   即filter不允许通过时会指向的页面。
   
### 提供的功能
主要分为pj基础要求&bonus（斜体字）提及部分，和个人保证网站运行基本逻辑加入的额外功能。

#### 基础功能部分
+ 首页：收藏热度最高图片轮播图形式展示，更新/上传时间最新图片以类表格形式展示（包含名称、上传用户名、更新时间）
+ 搜索页：根据内容和名称为关键词搜索，按时间和热度对搜索结果进行排序。
+ 图片信息页面：展示完整图片、图片名称、内容关键词、描述、上传时间、上传用户名、国家/区域名、城市名、收藏数量、*评论*等信息，任何用户都可以进行评论展示
顺序的切换（由时间顺序或热度顺序）；*图片可以局部放大观看*
   + 对登录用户：可以进行收藏/取消收藏操作；*发表自己的评论，删除自己的评论，为他人的评论点赞*。
   + 对未登录用户：不可以收藏、评论、点赞，收藏按钮上方有提示用户未登录的信息，若点击收藏按钮将跳转至登录界面，登录后自动回到当前图片页面。
+ 上传页面：为私人空间，登录后方可进入。用户可上传新照片，进行老照片的修改。
+ 我的照片页面：分页展示（每页6个）用户上传的图片，每张图片都有修改或删除选项，点击修改按钮前往上传界面，并自动加载已有信息；点击删除按钮会弹窗提醒用户
此行为将不可逆地删除照片且与之相关的收藏也将被全部删除。
+ 我的收藏页面：展示用户收藏的图片和我的足迹（最近10张浏览过的图片），如果是本人收藏页面则有取消收藏按钮和公开与否按钮，若是好友页面则没有相应的按钮。
+ 我的好友页面：左栏最上方可进行搜索、发送请求；其下显示已发送请求的处理状态，在下面是接收到的请求进行处理；右栏则显示已添加的好友，点击名字或邮箱
会跳转到对应好友的收藏页面；若对方不公开，则会直接alert这一信息，并且不跳转。
+ 登陆界面：用户可通过用户名或邮箱和密码进行登录，同时有*验证码*需要输入，若验证码不对将不验证密码或用户名是否正确。
+ 注册界面：需要填写的具体信息包括用户名、密码、二次密码确认、邮箱以及*验证码*。密码输入块在失去焦点后进行判断密码强弱，并作出相应的ui提示，点击提交后
由ajax异步请求判断用户名是否重复、验证码是否正确、信息是否完整等，任何有错则不允许提交表单。

#### 额外功能部分
1. **检测是否登录的filter**：对私人空间（登录后才提供的功能servlet及jsp）设置filter，若用户未登录但试图通过url强行访问将被引导至登录界面，已登录用户则
直接放行
2. **检测是否是修改图片主人的filter**：在由我的照片页面的modify页面进入uploadservlet进行修改时由于通过url传递图片id参数，存在用户恶意修改url中id值
对其他用户的图片进行修改的情况，此filter会判断该图片信息中记录的uid与当前登录用户uid是否一致，若一致则放行；若不一致将引导到错误页面，提示不存在相应
资源（下方提供链接重定向到首页）
3. **收藏页面展示filter**：收藏页面同样存在恶意篡改url来访问其他用户收藏图片的可能，此filter会进行3次判断：
   + url中参数uid是登录用户本人uid，直接放行。
   + url中参数uid不是登录用户的好友：直接引导到错误页面（与上一个filter中的一致）。
   + url中参数uid是登录用户的好友：
      + 此用户同意公开：放行。
	  + 此用户不同意公开：不放行，引导到错误页面
	  
### 重要/新增功能实现途径
1. 前端加密后端传输功能：
   + 注册：前端在确认所有信息无误后，随机生成一串随机数作为salt加在用户设置的密码后，并对整个密码用md5算法加密并传递给后端保存，salt也会同时保存在该用户
   信息中。
   + 登录：在点击提交按钮后ajax异步请求获取该用户名对应的salt，加在原密码后进行md5算法加密并发送到后端与数据库中的密码是否一致。
2. 我的足迹功能：
   + 未登录：不进行记录。
   + 登录后：在点进一张图片的详细信息、picInfo这一servlet向数据库获取信息时，同时向history表中插入一条有图片id和用户uid的信息。如果之前已经由相同的信息
   就将前者删除再记录新的这条信息。而展示足迹时选取表中uid为对应用户的最后十张图。
3. 用户密码强弱的ui醒目提示：对输入框绑定在其失去焦点时调用判断强弱的函数。此函数首先清除提示条（bootstrap中的progress bar组件）中已有信息。接着获取
密码内容：`let password = document.getElementsByName("password")[0].value；`，然后根据不同的正则表达式对其进行判断，显示各自的结果（为强则进度条为绿，
100%，提示”strong”；中等强度为黄色，60%，提示”safe”……不合法则为红色，100%，提示”Invalid！”）
4. 验证码：ValidateCode类生成一个随机数字、字母（长度、干扰线数量可指定）的验证码；verifyCodeServlet利用new语句生成此类的新实例，并向session中设置验证码
的值作为记录；登录与注册页面上设置img元素，其src地址为向此servlet进行请求，即：` src="${pageContext.request.contextPath}/verifyCode"`。
5. 评论功能：点赞、排序、删除自己的评论都为ajax向后端发送异步请求得到。发表新评论则相当于提交一个表单
   + 点击时间和热度按钮实现重新排序的完整过程为: 首先将当前按钮的图标改为未选中状态的蓝色，class变为noRankByxx，删去所有评论内容。接着用ajax向servlet
   用post方式发送请求，请求结果用json格式传回给js，根据请求结果创建对应的div（comment）和其中子标签（比如是可点赞/已赞/未登录不能点赞，这条评论该用户
   是否可删除等），并append到commentsArea这一div中。
   + 由于这个重新排序无法使用刷新的方式来更新资源（sad），因此需要注意也是我第一次忽视的地方就是js删去原来所有标签之后创建和加入的标签并没有添加对应函数，
   因此需要在ajax成功返回会调用的函数内加上绑定这一语句。
   ``` $(this).attr("src",application+"/resources/images/icons/时间-on.png");
    $(this).attr("class","rankByTime");
    $(".rankByHot").attr("src",application+"/resources/images/icons/热度.png");
    $(".rankByHot").attr("class","notRankByHot");
    $(".notRankByHot").bind("click",changeCommentHot);
	```
6. 局部放大功能：
   + 放大镜出现与消失的依据：加载页面时就设置放大部分和图片中选图框的display为none，当用户鼠标移到图片上时，将其display变为”block”；
   + 放大镜随着鼠标移动的实现：得到鼠标的位置，通过到容器的left距离和top距离确定位置，考虑是否鼠标顶在边框上的可能（移动框不可以超出边框），得到矫正异常
   情况后的left与top值后，将其赋值给移动框相应的left值和top值。
   + 放大镜得到放大的部分的原理：得到现有位置与可能达到的最大位置之比，再用此比例乘以可能的最大位置，由于放大镜实现原理，反向变动（用-来乘）
7. 实现方式相似的功能：例如删除图片、在收藏页面的取消收藏、获取盐值、获取重复姓名、改变公开状态、改变评论排列顺序等功能，都是通过ajax异步请求的方式获得
的，简单提及，不是新学的知识也不是新的功能要求。

### 有关功能的反思
1. 使用的刷新次数较多：为了显示内容的改变，收藏、点赞、删除都在ajax发请求并得到正确实现后刷新界面得到，对用户体验较不佳
2. 相关翻页的操作通过url进行，有潜在的危险并且较为冗长
3. 验证码功能的不完善性，未提供点击验证码更新的功能。
